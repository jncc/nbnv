[#ftl]
MAP
    IMAGETYPE                                             PNG
    EXTENT                                                0 0 800000 800000
    SIZE                                                  2800 2800
    IMAGECOLOR                                            255 255 255
    FONTSET                                               "fonts/fontset"

    WEB
        IMAGEPATH                                           "/ms4w/tmp/ms_tmp/"
        IMAGEURL                                            "/ms_tmp/"
        METADATA
            "wms_title"                                       "Site Boundary Dataset Map"
            "wms_onlineresource"                              "http://NBNImporter-a.nerc-lancaster.ac.uk/mapserver/SingleSpeciesWMS?"
            "wms_srs"                                         "EPSG:29903 EPSG:27700 EPSG:4326 EPSG:3857"
            "wms_enable_request"                              "*"
        END
    END

    PROJECTION
        "init=epsg:27700"
    END

    [#list siteBoundaries as dataset]
        LAYER
            NAME                                                "${dataset.datasetKey}"
            TYPE                                                POLYGON
            STATUS                                              OFF
            CONNECTIONTYPE                                      PLUGIN
            PLUGIN                                              "msplugin_mssql2008.dll"
            CONNECTION                                          "${properties.spatialConnection}"
            PROCESSING                                          "CLOSE_CONNECTION=DEFER"

            DATA                        "geom from (
                                            SELECT geom, sbfd.featureID 
                                            FROM SiteBoundaryFeatureData AS sbfd 
                                                WITH(INDEX(sidx_SiteBoundaryFeatureData_geom)) 
                                            INNER JOIN SiteBoundaryData sbd ON sbd.featureID = sbfd.featureID 
                                            WHERE siteBoundaryDatasetKey = '${dataset.datasetKey}'
                                        ) AS foo USING UNIQUE featureID USING SRID=4326"

            PROJECTION
                "init=epsg:4326"
            END

            CLASS
                NAME                                              "default"

                STYLE
                    COLOR                                           255 255 0
                    OUTLINECOLOR                                    0 0 0
                    WIDTH                                           0.5
                END
            END
        END
    [/#list]
END